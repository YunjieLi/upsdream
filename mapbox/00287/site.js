mapboxgl.accessToken = 'pk.eyJ1IjoieXVuamllbGkiLCJhIjoiY2lxdmV5MG5rMDAxNmZta3FlNGhyMmpicSJ9.CTEQgAyZGROcpJouZuzJyA';

var mystyle = 'mapbox://styles/yunjieli/cjxmtvnz924u31cqm7iqzji04'
var color2016 = '#aed'
var color1898 = '#3bb'
var color1788 = '#079'
var colorAccent = '#fff'
var fillOpacity = .8
var years = [1788, 1898, 2016]

var isBlog
var isMobile

// mobile if the screen is no wider than 640px
$(window).width() <= 640 ? isMobile = true : isMobile = false;

// if it's embedded in a blog post
window.location.search.indexOf('embed') !== -1 ? isBlog = true : isBlog = false;

var map = new mapboxgl.Map({
    container: 'map',
    // style: 'mapbox://styles/yunjieli/cirziwje4000sg9m1fs1tyce6',
    style: mystyle,
    center: [-71.07572517602875, 42.35955016882079],
    zoom: 13.1,
    transition: {
      duration: .4,
      delay: .2
    }
});

// Disable scroll in posts
isBlog ? map.scrollZoom.disable() : null;

// fly to a different location on load on mobile screen
if (isMobile) {
    map.flyTo( {
        center: [-71.06136, 42.36419],
        zoom: 12.5
    });
}

// Set max bound to the smaller historical map
var SE = [-70.95, 42.312195600849606]
var NW = [-71.12691722097027, 42.400356011143344]
var NW_mobile = [-71.12691722097027, 42.405]
map.setMaxBounds([SE, isMobile ? NW_mobile : NW]);

var cards = [
    {
        "id": "card-overview",
        "title": "Overview",
        "description": "I used the <a href='https://www.mapbox.com/mapbox-studio/dataset-editor/' target='_blank'>Mapbox Studio dataset editor</a> to trace Boston's coastlines from <a href='http://calvert.hul.harvard.edu:8080/opengeoportal/openGeoPortalHome.jsp?BasicSearchTerm=LayerId:HARVARD.SDE2.MATWN_3764_B6S3_1788_C6' target='_blank'>1788</a> and <a href='http://calvert.hul.harvard.edu:8080/opengeoportal/openGeoPortalHome.jsp?BasicSearchTerm=LayerId:HARVARD.SDE2.MATWN_3764_B6G5_1898_M3' target='_blank'>1898</a>. See how Boston has grown over the centuries!",
        "camera": {
            center: [-71.07572517602875, 42.35955016882079],
            zoom: 13.1,
        },
        "cameraBlog": {
            center: [-71.07572517602875, 42.35955016882079],
            zoom: 13.1,
        },
        "show1788": true,
        "show1898": true,
        "show2016": true,
        "gotoYear": 9999,
    }, {
        "id": "card-peninsula",
        "title": "The Shawmut Peninsula",
        "description": "Once a small hilly peninsula, little had changed until 1788 since Boston was first built in 1630.",
        "camera": {
            center: [-71.07176780684654, 42.35586158920927],
            zoom: 13.55,
        },
        "cameraBlog": {
            center: [-71.0744, 42.3554],
            zoom: 12.9,
        },
        "show1788": true,
        "show1898": false,
        "show2016": false,
        "showYear": 1788,
    },{
        "id": "card-grid",
        "title": "A Legacy in Streets",
        "description": "In Cambridge today, the triangle space between Main Street and Mass Ave are still reminiscent of the historical shorelines.",
        "camera": {
            center: [-71.0934895258428, 42.35682240092123],
            zoom: 14.2,
        },
        "cameraBlog": {
            center: [-71.09216088392276, 42.360910001881734],
            zoom: 13.567,
        },
       "show1788": true,
        "show1898": false,
        "show2016": false,
        "gotoYear": 1788,
    }, {
        "id": "card-backbay",
        "title": "The Back Bay",
        "description": "By 1820 landfill projects had begun, including the filling of <a href='https://en.wikipedia.org/wiki/Back_Bay,_Boston' target='_blank'>the Back Bay</a>, which nearly doubled the size of Boston peninsula.",
        "camera": {
            center: [-71.08635875418763, 42.35457447576792],
            zoom: 13.55,
        },
        "cameraBlog": {
            center: [-71.08386, 42.3524],
            zoom: 13.17,
        },
        "show1788": true,
        "show1898": true,
        "show2016": false,
        "gotoYear": 1898,
    }, {
        "id": "card-airport",
        "title": "Logan Airport (BOS)",
        "description": "The area which became Logan airport today began to be filled as late as in 1922.",
        "camera": {
            center: [-71.01973397995576, 42.36449170568267],
            zoom: 13,
        },
        "cameraBlog": {
            center: [-71.0239, 42.3638],
            zoom: 12.7,
        },
        "show1788": false,
        "show1898": true,
        "show2016": true,
        "gotoYear": 2016,
}];

var markup_grid = {
    "type": "FeatureCollection",
    "features": [
    {
        "geometry": {
            "coordinates": [
                  [
                    -71.07163789207728,
                    42.361276180837336
                  ],
                  [
                    -71.10044056883004,
                    42.36349888912406
                  ]
            ],
            "type": "LineString"
        },
        "type": "Feature",
        "properties": {
            "name": "Main St",
            "card": "card-grid",
            "paint": {
                "line-width": 3,
                "line-color": colorAccent,
            },
            "order": "road-rail",
        }
    }, {
        "geometry": {
            "coordinates": [
              [
                -71.06148405916029,
                42.32045556502095
              ],
              [
                -71.07164328986534,
                42.33218810792718
              ],
              [
                -71.08041859253582,
                42.339296044656635
              ],
              [
                -71.0817002770592,
                42.34057435631095
              ],
              [
                -71.085934863903,
                42.34342691409441
              ],
              [
                -71.09312172439807,
                42.35832040082249
              ],
              [
                -71.09369308991785,
                42.3592154755633
              ],
              [
                -71.09456156550804,
                42.35997543467488
              ],
              [
                -71.09604711585968,
                42.36088737347612
              ],
              [
                -71.10703671991827,
                42.367418532119075
              ],
              [
                -71.10772581096826,
                42.36786238495631
              ],
              [
                -71.10887429605151,
                42.368449832418776
              ],
              [
                -71.1126908003281,
                42.36982052180045
              ],
              [
                -71.1160302415702,
                42.37257486430394
              ],
              [
                -71.11854326991411,
                42.37332068126378
              ],
              [
                -71.11881268474829,
                42.37375907528528
              ],
              [
                -71.1187962771347,
                42.37430610196145
              ],
              [
                -71.12013022046887,
                42.3777353500476
              ],
              [
                -71.1191456799959,
                42.3872019202995
              ],
              [
                -71.11972533969093,
                42.38917371883946
              ],
              [
                -71.12101488165605,
                42.39032900776468
              ],
              [
                -71.12387127867582,
                42.391739144588286
              ],
              [
                -71.1286915135343,
                42.39596936436766
              ]
            ],
            "type": "LineString"
          },
        "type": "Feature",
        "properties": {
            "name": "MassAve",
            "card": "card-grid",
            "paint": {
                "line-width": 3,
                "line-color": colorAccent,
            },
            "order": "road-rail"
        }
    }]
}

var markup_peninsula = {
    "geometry": {
        "coordinates": [
            [
                [-71.066998,
                    42.345487
                ],
                [-71.067612,
                    42.3456
                ],
                [-71.067051,
                    42.347489
                ],
                [-71.067155,
                    42.34919
                ],
                [-71.068843,
                    42.350133
                ],
                [-71.070019,
                    42.350624
                ],
                [-71.070276,
                    42.351228
                ],
                [-71.070787,
                    42.351455
                ],
                [-71.070738,
                    42.353911
                ],
                [-71.071556,
                    42.35357
                ],
                [-71.071965,
                    42.353872
                ],
                [-71.072079,
                    42.354341
                ],
                [-71.071728,
                    42.354699
                ],
                [-71.071278,
                    42.354674
                ],
                [-71.070877,
                    42.35444
                ],
                [-71.071011,
                    42.35497
                ],
                [-71.071228,
                    42.355686
                ],
                [-71.071297,
                    42.357129
                ],
                [-71.07146,
                    42.357941
                ],
                [-71.072152,
                    42.358763
                ],
                [-71.072421,
                    42.359331
                ],
                [-71.072115,
                    42.360692
                ],
                [-71.070811,
                    42.361515
                ],
                [-71.069545,
                    42.36265
                ],
                [-71.069547,
                    42.363898
                ],
                [-71.069719,
                    42.364106
                ],
                [-71.069925,
                    42.364888
                ],
                [-71.0704,
                    42.365203
                ],
                [-71.070858,
                    42.365297
                ],
                [-71.070827,
                    42.365554
                ],
                [-71.070242,
                    42.365577
                ],
                [-71.069468,
                    42.366138
                ],
                [-71.069626,
                    42.366395
                ],
                [-71.069342,
                    42.366535
                ],
                [-71.068852,
                    42.366512
                ],
                [-71.068521,
                    42.366853
                ],
                [-71.068325,
                    42.367142
                ],
                [-71.068269,
                    42.366987
                ],
                [-71.068088,
                    42.366832
                ],
                [-71.067724,
                    42.366967
                ],
                [-71.067444,
                    42.36676
                ],
                [-71.067542,
                    42.366626
                ],
                [-71.067514,
                    42.366409
                ],
                [-71.06708,
                    42.365934
                ],
                [-71.066828,
                    42.365852
                ],
                [-71.066604,
                    42.36548
                ],
                [-71.065961,
                    42.365098
                ],
                [-71.065708,
                    42.364571
                ],
                [-71.064855,
                    42.363879
                ],
                [-71.063806,
                    42.363363
                ],
                [-71.062924,
                    42.362971
                ],
                [-71.062085,
                    42.362806
                ],
                [-71.061106,
                    42.362445
                ],
                [-71.06056,
                    42.361991
                ],
                [-71.060015,
                    42.361805
                ],
                [-71.058505,
                    42.362012
                ],
                [-71.057303,
                    42.362302
                ],
                [-71.056967,
                    42.362612
                ],
                [-71.056366,
                    42.362613
                ],
                [-71.056842,
                    42.362974
                ],
                [-71.056437,
                    42.36346
                ],
                [-71.056087,
                    42.363584
                ],
                [-71.055682,
                    42.363977
                ],
                [-71.055809,
                    42.364834
                ],
                [-71.056354,
                    42.365123
                ],
                [-71.05655,
                    42.365319
                ],
                [-71.056788,
                    42.365691
                ],
                [-71.056705,
                    42.366032
                ],
                [-71.056705,
                    42.36659
                ],
                [-71.056873,
                    42.36691
                ],
                [-71.055979,
                    42.367283
                ],
                [-71.053728,
                    42.368402
                ],
                [-71.053813,
                    42.368623
                ],
                [-71.054112,
                    42.368701
                ],
                [-71.054026,
                    42.368843
                ],
                [-71.053643,
                    42.368843
                ],
                [-71.053408,
                    42.368529
                ],
                [-71.052257,
                    42.368529
                ],
                [-71.051895,
                    42.368844
                ],
                [-71.051648,
                    42.368853
                ],
                [-71.051751,
                    42.368687
                ],
                [-71.051648,
                    42.368559
                ],
                [-71.051958,
                    42.368253
                ],
                [-71.051613,
                    42.368253
                ],
                [-71.051423,
                    42.368291
                ],
                [-71.051423,
                    42.3681
                ],
                [-71.05125,
                    42.368036
                ],
                [-71.05106,
                    42.368011
                ],
                [-71.050973,
                    42.367743
                ],
                [-71.05068,
                    42.367718
                ],
                [-71.05018,
                    42.368126
                ],
                [-71.049972,
                    42.368139
                ],
                [-71.049972,
                    42.367999
                ],
                [-71.050179,
                    42.367833
                ],
                [-71.050024,
                    42.367718
                ],
                [-71.049696,
                    42.367757
                ],
                [-71.049177,
                    42.367323
                ],
                [-71.049592,
                    42.367119
                ],
                [-71.049315,
                    42.366736
                ],
                [-71.048883,
                    42.366877
                ],
                [-71.048728,
                    42.366864
                ],
                [-71.04878,
                    42.366698
                ],
                [-71.049073,
                    42.366634
                ],
                [-71.048831,
                    42.366315
                ],
                [-71.04859,
                    42.366379
                ],
                [-71.048417,
                    42.366328
                ],
                [-71.048607,
                    42.366188
                ],
                [-71.048434,
                    42.365856
                ],
                [-71.047536,
                    42.365793
                ],
                [-71.047208,
                    42.366087
                ],
                [-71.046569,
                    42.366049
                ],
                [-71.046897,
                    42.365666
                ],
                [-71.047259,
                    42.365615
                ],
                [-71.047915,
                    42.365627
                ],
                [-71.048123,
                    42.365499
                ],
                [-71.048468,
                    42.365499
                ],
                [-71.048571,
                    42.365206
                ],
                [-71.048243,
                    42.365193
                ],
                [-71.048036,
                    42.365129
                ],
                [-71.047742,
                    42.365117
                ],
                [-71.047656,
                    42.364989
                ],
                [-71.047915,
                    42.364925
                ],
                [-71.048208,
                    42.364938
                ],
                [-71.048364,
                    42.364798
                ],
                [-71.048053,
                    42.364645
                ],
                [-71.048104,
                    42.364543
                ],
                [-71.048415,
                    42.364593
                ],
                [-71.048726,
                    42.364606
                ],
                [-71.049002,
                    42.364364
                ],
                [-71.048795,
                    42.364249
                ],
                [-71.048881,
                    42.364147
                ],
                [-71.049157,
                    42.364172
                ],
                [-71.049364,
                    42.363777
                ],
                [-71.049209,
                    42.363713
                ],
                [-71.049252,
                    42.363651
                ],
                [-71.049436,
                    42.363672
                ],
                [-71.049561,
                    42.363444
                ],
                [-71.049088,
                    42.363265
                ],
                [-71.049223,
                    42.363108
                ],
                [-71.049832,
                    42.363201
                ],
                [-71.049945,
                    42.362947
                ],
                [-71.049551,
                    42.362802
                ],
                [-71.049187,
                    42.362713
                ],
                [-71.048899,
                    42.362623
                ],
                [-71.048354,
                    42.362702
                ],
                [-71.047338,
                    42.362479
                ],
                [-71.047368,
                    42.36221
                ],
                [-71.047793,
                    42.362154
                ],
                [-71.047884,
                    42.362333
                ],
                [-71.048399,
                    42.362433
                ],
                [-71.048823,
                    42.362411
                ],
                [-71.049217,
                    42.362522
                ],
                [-71.049672,
                    42.362533
                ],
                [-71.049929,
                    42.362388
                ],
                [-71.05005,
                    42.362522
                ],
                [-71.050263,
                    42.362466
                ],
                [-71.050262,
                    42.362343
                ],
                [-71.05052,
                    42.362331
                ],
                [-71.050566,
                    42.362443
                ],
                [-71.050899,
                    42.36241
                ],
                [-71.050853,
                    42.362242
                ],
                [-71.051005,
                    42.362186
                ],
                [-71.051065,
                    42.362309
                ],
                [-71.051293,
                    42.362298
                ],
                [-71.051308,
                    42.36213
                ],
                [-71.051459,
                    42.362174
                ],
                [-71.051778,
                    42.36242
                ],
                [-71.051944,
                    42.362308
                ],
                [-71.051883,
                    42.362051
                ],
                [-71.051929,
                    42.361861
                ],
                [-71.052217,
                    42.361961
                ],
                [-71.052611,
                    42.362017
                ],
                [-71.052762,
                    42.361771
                ],
                [-71.052671,
                    42.361558
                ],
                [-71.052989,
                    42.361468
                ],
                [-71.053292,
                    42.361524
                ],
                [-71.053716,
                    42.361524
                ],
                [-71.053731,
                    42.361367
                ],
                [-71.053928,
                    42.361098
                ],
                [-71.053897,
                    42.360897
                ],
                [-71.054125,
                    42.360818
                ],
                [-71.054382,
                    42.360885
                ],
                [-71.05461,
                    42.360818
                ],
                [-71.054276,
                    42.360438
                ],
                [-71.053897,
                    42.360483
                ],
                [-71.053397,
                    42.360427
                ],
                [-71.053397,
                    42.360326
                ],
                [-71.053958,
                    42.360315
                ],
                [-71.054276,
                    42.360169
                ],
                [-71.054837,
                    42.360482
                ],
                [-71.054957,
                    42.360191
                ],
                [-71.054897,
                    42.359967
                ],
                [-71.055063,
                    42.359765
                ],
                [-71.054502,
                    42.35962
                ],
                [-71.054623,
                    42.359351
                ],
                [-71.05479,
                    42.359318
                ],
                [-71.054517,
                    42.359184
                ],
                [-71.054653,
                    42.358982
                ],
                [-71.05529,
                    42.358825
                ],
                [-71.055198,
                    42.358657
                ],
                [-71.05482,
                    42.358702
                ],
                [-71.054744,
                    42.358612
                ],
                [-71.055138,
                    42.358399
                ],
                [-71.054941,
                    42.358355
                ],
                [-71.051259,
                    42.358838
                ],
                [-71.051184,
                    42.358916
                ],
                [-71.051244,
                    42.359152
                ],
                [-71.052063,
                    42.359084
                ],
                [-71.052063,
                    42.359285
                ],
                [-71.050654,
                    42.359432
                ],
                [-71.050684,
                    42.359208
                ],
                [-71.050987,
                    42.359185
                ],
                [-71.050971,
                    42.358872
                ],
                [-71.048866,
                    42.359119
                ],
                [-71.048896,
                    42.359321
                ],
                [-71.049169,
                    42.359332
                ],
                [-71.049214,
                    42.3595
                ],
                [-71.048593,
                    42.359511
                ],
                [-71.048487,
                    42.358985
                ],
                [-71.048456,
                    42.358895
                ],
                [-71.048668,
                    42.358694
                ],
                [-71.048805,
                    42.358895
                ],
                [-71.050941,
                    42.358648
                ],
                [-71.051062,
                    42.358435
                ],
                [-71.051562,
                    42.358401
                ],
                [-71.051653,
                    42.358536
                ],
                [-71.054137,
                    42.35821
                ],
                [-71.054228,
                    42.357896
                ],
                [-71.054667,
                    42.357784
                ],
                [-71.054637,
                    42.357616
                ],
                [-71.054304,
                    42.35765
                ],
                [-71.054288,
                    42.357504
                ],
                [-71.054728,
                    42.357426
                ],
                [-71.054682,
                    42.357302
                ],
                [-71.053925,
                    42.35737
                ],
                [-71.054015,
                    42.357247
                ],
                [-71.054273,
                    42.357168
                ],
                [-71.054409,
                    42.357056
                ],
                [-71.054591,
                    42.357
                ],
                [-71.054591,
                    42.356765
                ],
                [-71.053969,
                    42.35662
                ],
                [-71.054,
                    42.356497
                ],
                [-71.054409,
                    42.356362
                ],
                [-71.054893,
                    42.355992
                ],
                [-71.054362,
                    42.355534
                ],
                [-71.053378,
                    42.355635
                ],
                [-71.053211,
                    42.355568
                ],
                [-71.053165,
                    42.354997
                ],
                [-71.052877,
                    42.355131
                ],
                [-71.052772,
                    42.355613
                ],
                [-71.052423,
                    42.355602
                ],
                [-71.052377,
                    42.355311
                ],
                [-71.05215,
                    42.355367
                ],
                [-71.052029,
                    42.355624
                ],
                [-71.051877,
                    42.355535
                ],
                [-71.051923,
                    42.35521
                ],
                [-71.051604,
                    42.355165
                ],
                [-71.051135,
                    42.355334
                ],
                [-71.050968,
                    42.355367
                ],
                [-71.050301,
                    42.355166
                ],
                [-71.050377,
                    42.354998
                ],
                [-71.051179,
                    42.354192
                ],
                [-71.050936,
                    42.354119
                ],
                [-71.050973,
                    42.353954
                ],
                [-71.051328,
                    42.354009
                ],
                [-71.051515,
                    42.353788
                ],
                [-71.051365,
                    42.353691
                ],
                [-71.051552,
                    42.35347
                ],
                [-71.051851,
                    42.353553
                ],
                [-71.052466,
                    42.353028
                ],
                [-71.052171,
                    42.352653
                ],
                [-71.052315,
                    42.352576
                ],
                [-71.052814,
                    42.353055
                ],
                [-71.052924,
                    42.352989
                ],
                [-71.052575,
                    42.352649
                ],
                [-71.052939,
                    42.352595
                ],
                [-71.052736,
                    42.352297
                ],
                [-71.052944,
                    42.352201
                ],
                [-71.053217,
                    42.35237
                ],
                [-71.053817,
                    42.352137
                ],
                [-71.053581,
                    42.351933
                ],
                [-71.053907,
                    42.351888
                ],
                [-71.054111,
                    42.352059
                ],
                [-71.054261,
                    42.351974
                ],
                [-71.054163,
                    42.3518
                ],
                [-71.054342,
                    42.351759
                ],
                [-71.05455,
                    42.351875
                ],
                [-71.054832,
                    42.351786
                ],
                [-71.054896,
                    42.3516
                ],
                [-71.055203,
                    42.351612
                ],
                [-71.055487,
                    42.351469
                ],
                [-71.055474,
                    42.351011
                ],
                [-71.055644,
                    42.351022
                ],
                [-71.055718,
                    42.351413
                ],
                [-71.056111,
                    42.351474
                ],
                [-71.056404,
                    42.351051
                ],
                [-71.056466,
                    42.350763
                ],
                [-71.056874,
                    42.350757
                ],
                [-71.056914,
                    42.350475
                ],
                [-71.056835,
                    42.350195
                ],
                [-71.057375,
                    42.350149
                ],
                [-71.057889,
                    42.350257
                ],
                [-71.058361,
                    42.350362
                ],
                [-71.058079,
                    42.350477
                ],
                [-71.058165,
                    42.350664
                ],
                [-71.058553,
                    42.350749
                ],
                [-71.059142,
                    42.350787
                ],
                [-71.059275,
                    42.350471
                ],
                [-71.059483,
                    42.350495
                ],
                [-71.059426,
                    42.350816
                ],
                [-71.060048,
                    42.350886
                ],
                [-71.060169,
                    42.350559
                ],
                [-71.060519,
                    42.35055
                ],
                [-71.06052,
                    42.350907
                ],
                [-71.060945,
                    42.350902
                ],
                [-71.061063,
                    42.350567
                ],
                [-71.062153,
                    42.350541
                ],
                [-71.06259,
                    42.350577
                ],
                [-71.062654,
                    42.350816
                ],
                [-71.063416,
                    42.350901
                ],
                [-71.063017,
                    42.350561
                ],
                [-71.062829,
                    42.350402
                ],
                [-71.062894,
                    42.350232
                ],
                [-71.063256,
                    42.350277
                ],
                [-71.063483,
                    42.349909
                ],
                [-71.06336,
                    42.349764
                ],
                [-71.063421,
                    42.349627
                ],
                [-71.063887,
                    42.349648
                ],
                [-71.063889,
                    42.349415
                ],
                [-71.063618,
                    42.349335
                ],
                [-71.063672,
                    42.349143
                ],
                [-71.064001,
                    42.349103
                ],
                [-71.064099,
                    42.34889
                ],
                [-71.063879,
                    42.348732
                ],
                [-71.063814,
                    42.348562
                ],
                [-71.063476,
                    42.348475
                ],
                [-71.063616,
                    42.348329
                ],
                [-71.06409,
                    42.348391
                ],
                [-71.064229,
                    42.348318
                ],
                [-71.064477,
                    42.348287
                ],
                [-71.064862,
                    42.348193
                ],
                [-71.064843,
                    42.347988
                ],
                [-71.064406,
                    42.347889
                ],
                [-71.064392,
                    42.347712
                ],
                [-71.064762,
                    42.347738
                ],
                [-71.064879,
                    42.347515
                ],
                [-71.064626,
                    42.347462
                ],
                [-71.064693,
                    42.34721
                ],
                [-71.065039,
                    42.347208
                ],
                [-71.065181,
                    42.346897
                ],
                [-71.064792,
                    42.346833
                ],
                [-71.065126,
                    42.34673
                ],
                [-71.065069,
                    42.346459
                ],
                [-71.065402,
                    42.346201
                ],
                [-71.065906,
                    42.345647
                ],
                [-71.065836,
                    42.345473
                ],
                [-71.065966,
                    42.345389
                ],
                [-71.066608,
                    42.345388
                ],
                [-71.066617,
                    42.345407
                ],
                [-71.066998,
                    42.345487
                ]
            ]
        ],
        "type": "Polygon"
    },
    "type": "Feature",
    "properties": {
        "name": "Boston peninsula",
        "card": "card-peninsula",
        "paint": {
            "line-width": 1,
            "line-color": colorAccent,
        },
        "order": "place-islands"
    }
}

var markup_empty = {
  "type": "FeatureCollection",
  "features": []
}

var activeCard = 0

// Load first card in slideshow
$('#card h2').html(cards[activeCard].title);
$('#card p').html(cards[activeCard].description);

map.on('load', function() {

    // map.setTransition({duration: .2});

    // Move navigations to bottom-left on mobile screens
    map.addControl(new mapboxgl.Navigation( isMobile ? {position: 'bottom-left'} : {position:'top-right'} ));

    // Add highlight layer for the slideshow;
    addLayers();

    // Add interactions to control buttons
    $('.year').click(function() {
        // Get current year
        var year_active = $(this).prop('id').substring(1);
        showYear(year_active, $(this).hasClass('stroke'));
        // gotoYear(year_active);
    });

    // Slideshow
    $('#next').click(function() {
        // Go to next cardID
        if (activeCard === (cards.length - 1)) {
            activeCard = 0;
        } else {
            activeCard++;
        }
        updateCard(activeCard);
    });
    $('#prev').click(function() {
        // Go to next cardID
        if (activeCard === 0) {
            activeCard = cards.length - 1;
        } else {
            activeCard--;
        }
        updateCard(activeCard);
    });

    // TESTING use
    map.on('dragend', function() {
        center = map.getCenter();
        $('#center').html(center.lng + ", " + center.lat);
    });
    map.on('zoomend', function() {
        $('#zoom').html(map.getZoom());
    });
});

// Update map/text to the given cardID
function updateCard(i) {
    // Update slideshow content
    $('#card h2').html(cards[i].title);
    $('#card p').html(cards[i].description);

    // Update map
    map.easeTo( isBlog ? cards[i].cameraBlog : cards[i].camera );

    showYear(1898, cards[i].show1898);
    showYear(1788, cards[i].show1788);
    showYear(2016, cards[i].show2016);
    // gotoYear( cards[i].gotoYear );

    // Update markup layer
    if ( cards[i].id === 'card-grid' ){
        map.getSource('markup').setData( markup_grid );
    } else {
        map.getSource('markup').setData( markup_empty );;
    }
    // map.setLayoutProperty(cards[i].id, 'visibility', 'visible');
};

function addLayers() {
    // Add empty geojson source for markup layer by default
    map.addSource('markup', {
        type: "geojson",
        data: markup_empty,
    });

    // Add the markup layer right above the coastline layers
    map.addLayer({
        "id": "markup",
        "type": "line",
        "source": "markup",
        "paint": {
            "line-color": colorAccent,
            "line-width": 1,
            "line-dasharray": [4,2]
        },
    }, 'wave1788');
}

// Show year with checkbox buttons
function showYear(year, visible) {
    if (visible) {
        map.setPaintProperty('water' + year, 'fill-opacity', 1);
        map.setPaintProperty('wave' + year, 'fill-opacity', 1);
        $('#y' + year).removeClass('stroke');
    } else {
        map.setPaintProperty('water' + year, 'fill-opacity', 0);
        map.setPaintProperty('wave' + year, 'fill-opacity', 0);
        $('#y' + year).addClass('stroke');
    }
}

// NOT IN USE: Show year with radius button
function gotoYear(year_active) {
    years.forEach(function(year) {
        // Global styling edits
        map.setPaintProperty('coast' + year, 'line-width', 1.4);

        // If 9999, show all layers
        if (year_active === 9999) {
            showYear(year, true);
        } else {
            // For active year, show fill hide border.
            // Show border hide fill for inactive years.
            if (year === year_active) {
                map.setPaintProperty('water' + year, 'fill-opacity', 1);
                map.setPaintProperty('wave' + year, 'fill-opacity', 1);
                // map.setPaintProperty('water' + year, 'fill-opacity', .8);
            } else {
                map.setPaintProperty('coast' + year, 'fill-opacity', 1);
                map.setPaintProperty('water' + year, 'fill-opacity', 0);
                // map.setPaintProperty('water' + year, 'fill-opacity', .3);
            }
        }
    });
}
